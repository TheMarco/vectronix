/**
 * Vector stroke font for title rendering.
 * Each character is defined as an array of line segments in a 5×7 grid.
 * Coordinates: [x1, y1, x2, y2] where x ∈ [0,4], y ∈ [0,6]
 */
const CHARS = {
  V: [[0,0,2,6],[2,6,4,0]],
  E: [[4,0,0,0],[0,0,0,6],[0,6,4,6],[0,3,3,3]],
  C: [[4,0,0,0],[0,0,0,6],[0,6,4,6]],
  T: [[0,0,4,0],[2,0,2,6]],
  A: [[0,6,2,0],[2,0,4,6],[0.8,3.6,3.2,3.6]],
  L: [[0,0,0,6],[0,6,4,6]],
  G: [[4,0,0,0],[0,0,0,6],[0,6,4,6],[4,6,4,3],[4,3,2,3]],

  // Extra chars for credits etc
  P: [[0,6,0,0],[0,0,4,0],[4,0,4,3],[4,3,0,3]],
  R: [[0,6,0,0],[0,0,4,0],[4,0,4,3],[4,3,0,3],[1,3,4,6]],
  S: [[4,0,0,0],[0,0,0,3],[0,3,4,3],[4,3,4,6],[4,6,0,6]],
  N: [[0,6,0,0],[0,0,4,6],[4,6,4,0]],
  I: [[1,0,3,0],[2,0,2,6],[1,6,3,6]],
  O: [[0,0,4,0],[4,0,4,6],[4,6,0,6],[0,6,0,0]],
  W: [[0,0,1,6],[1,6,2,3],[2,3,3,6],[3,6,4,0]],
  D: [[0,0,3,0],[3,0,4,1],[4,1,4,5],[4,5,3,6],[3,6,0,6],[0,6,0,0]],
  F: [[4,0,0,0],[0,0,0,6],[0,3,3,3]],
  H: [[0,0,0,6],[4,0,4,6],[0,3,4,3]],
  K: [[0,0,0,6],[4,0,0,3],[0,3,4,6]],
  U: [[0,0,0,6],[0,6,4,6],[4,6,4,0]],
  Y: [[0,0,2,3],[4,0,2,3],[2,3,2,6]],
  M: [[0,6,0,0],[0,0,2,3],[2,3,4,0],[4,0,4,6]],
  X: [[0,0,4,6],[4,0,0,6]],
  Z: [[0,0,4,0],[4,0,0,6],[0,6,4,6]],
  ' ': [],
  '0': [[0,0,4,0],[4,0,4,6],[4,6,0,6],[0,6,0,0],[0,0,4,6]],
  '1': [[1,0,2,0],[2,0,2,6],[1,6,3,6]],
  '2': [[0,0,4,0],[4,0,4,3],[4,3,0,3],[0,3,0,6],[0,6,4,6]],
  '3': [[0,0,4,0],[4,0,4,6],[4,6,0,6],[0,3,4,3]],
  '4': [[0,0,0,3],[0,3,4,3],[4,0,4,6]],
  '5': [[4,0,0,0],[0,0,0,3],[0,3,4,3],[4,3,4,6],[4,6,0,6]],
  '6': [[4,0,0,0],[0,0,0,6],[0,6,4,6],[4,6,4,3],[4,3,0,3]],
  '7': [[0,0,4,0],[4,0,2,6]],
  '8': [[0,0,4,0],[4,0,4,6],[4,6,0,6],[0,6,0,0],[0,3,4,3]],
  '9': [[0,3,4,3],[4,3,4,0],[4,0,0,0],[0,0,0,3],[4,3,4,6]],
  '-': [[1,3,3,3]],
  '.': [[1.5,5.5,2.5,5.5],[2.5,5.5,2.5,6],[2.5,6,1.5,6],[1.5,6,1.5,5.5]],
  '!': [[2,0,2,4],[2,5.5,2,6]],
  '/': [[3.5,0,0.5,6]],
  ':': [[1.5,1.5,2.5,1.5],[2.5,1.5,2.5,2.5],[2.5,2.5,1.5,2.5],[1.5,2.5,1.5,1.5],
        [1.5,4,2.5,4],[2.5,4,2.5,5],[2.5,5,1.5,5],[1.5,5,1.5,4]],
  '+': [[2,1.5,2,4.5],[0.5,3,3.5,3]],
  'B': [[0,6,0,0],[0,0,3,0],[3,0,4,1],[4,1,3,3],[3,3,0,3],[3,3,4,4],[4,4,4,5],[4,5,3,6],[3,6,0,6]],
  'J': [[1,0,3,0],[2,0,2,5],[2,5,1,6],[1,6,0,5]],
  'Q': [[1,0,3,0],[3,0,4,1],[4,1,4,4],[4,4,3,5],[3,5,4,6],[3,5,1,5],[1,5,0,4],[0,4,0,1],[0,1,1,0]],
  '&': [[2,0,1,0],[1,0,0,1],[0,1,0,2],[0,2,1,3],[1,3,0,4],[0,4,0,5],[0,5,1,6],[1,6,3,6],[3,6,4,5],[4,5,1,3],[1,3,3,1],[3,1,2,0]],
  '©': [[1,0,3,0],[3,0,4,1],[4,1,4,5],[4,5,3,6],[3,6,1,6],[1,6,0,5],[0,5,0,1],[0,1,1,0],[3,2,1.5,2],[1.5,2,1.5,4],[1.5,4,3,4]],
};

/**
 * Render a string as vector lines.
 * Returns array of line segments: { x1, y1, x2, y2 }
 * text: the string
 * x, y: top-left position
 * scale: character scale (each char is 5*scale wide, 7*scale tall)
 * spacing: extra gap between chars (in addition to char width)
 */
export function vectorText(text, x, y, scale, spacing = 1) {
  const lines = [];
  const charWidth = 4 * scale + spacing * scale;
  let cx = x;

  for (const ch of text.toUpperCase()) {
    const strokes = CHARS[ch];
    if (strokes) {
      for (const s of strokes) {
        lines.push({
          x1: cx + s[0] * scale,
          y1: y + s[1] * scale,
          x2: cx + s[2] * scale,
          y2: y + s[3] * scale,
        });
      }
    }
    cx += charWidth;
  }

  return lines;
}

/**
 * Get the pixel width of a string at given scale.
 */
export function vectorTextWidth(text, scale, spacing = 1) {
  const charWidth = 4 * scale + spacing * scale;
  return text.length * charWidth - spacing * scale;
}
